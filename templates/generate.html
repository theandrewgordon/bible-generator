{% extends "base.html" %} {% block title %}Generate Bible Worksheet | Faith
Sparks Printables{% endblock %} {% block content %}
<h1 style="text-align: center">Create Your Worksheet</h1>
<form method="POST" action="/generate" onsubmit="showSpinner()">
  <label for="verse">Bible Verse (e.g. John 3:16 or John 3:16 (KJV))</label>
  <input
    type="text"
    name="verse"
    id="verse"
    required
    onblur="fetchPreview()"
    autocomplete="off"
    style="
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 6px;
      border: 1px solid #ccc;
    "
  />

  <div
    id="preview"
    style="
      display: none;
      font-size: 0.95em;
      background: #edf2f7;
      padding: 10px;
      border-radius: 6px;
      margin-top: -10px;
      margin-bottom: 20px;
    "
  ></div>

  <label for="version">Bible Version</label>
  <select
    name="version"
    id="version"
    style="
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 6px;
      border: 1px solid #ccc;
    "
  >
    <option value="auto" selected>Auto-detect from input</option>
    <option value="esv">English Standard Version (ESV)</option>
    <option value="kjv">King James Version (KJV)</option>
  </select>

  <details>
    <summary style="cursor: pointer; font-weight: 600; margin-bottom: 10px">
      ⚙️ Advanced Options
    </summary>
    <div
      style="
        padding: 12px;
        border-radius: 6px;
        background: #f0f0f0;
        margin-bottom: 20px;
      "
    >
      <label>
        <input type="checkbox" name="cursive" />
        Use cursive tracing font
      </label>
    </div>
  </details>

  <button
    type="submit"
    style="
      width: 100%;
      padding: 12px;
      background: #2b6cb0;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    "
  >
    Generate Worksheet
  </button>

  <div
    class="spinner"
    id="spinner"
    style="display: none; text-align: center; margin-top: 20px"
  >
    <img src="/static/spinner.gif" alt="Loading..." style="width: 48px" />
    <p>Generating your worksheet...</p>
  </div>

  <div
    class="download-message"
    id="download-msg"
    style="
      text-align: center;
      font-size: 0.9em;
      margin-top: 16px;
      color: #2f855a;
      display: none;
    "
  >
    ✅ Your worksheet has been generated!
  </div>
</form>

<a
  href="/download_all"
  style="
    display: block;
    text-align: center;
    margin: 20px auto;
    text-decoration: none;
    font-weight: bold;
    color: #2b6cb0;
  "
>
  ⬇ Download All Worksheets
</a>
{% endblock %} {% block extra_scripts %}
<script>
  function toggleDarkMode() {
    document.body.classList.toggle("dark");
    localStorage.setItem(
      "theme",
      document.body.classList.contains("dark") ? "dark" : "light"
    );
  }

  function showSpinner() {
    document.getElementById("spinner").style.display = "block";
    document.getElementById("download-msg").style.display = "block";
  }

  function fetchPreview() {
    const verse = document.getElementById("verse").value;
    const version = document.getElementById("version").value;
    const preview = document.getElementById("preview");

    if (verse.length < 4) return;

    const params = new URLSearchParams({ verse });
    if (version && version !== "auto") params.append("version", version);

    fetch(`/preview?${params.toString()}`)
      .then((res) => (res.ok ? res.text() : ""))
      .then((text) => {
        if (text) {
          preview.style.display = "block";
          preview.innerHTML = text;
        }
      })
      .catch(() => {
        preview.style.display = "none";
      });
  }

  if (localStorage.getItem("theme") === "dark") {
    document.body.classList.add("dark");
  }
</script>
{% endblock %}
