{% extends "base.html" %} {% block title %}Worksheet History | Faith Sparks
Printables{% endblock %} {% block content %}
<h1>üóÇ Worksheet History</h1>
<p>Logged in as: <strong>{{ email }}</strong></p>

<div
  class="filter-bar"
  style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 24px"
>
  <input
    type="text"
    id="searchInput"
    placeholder="Search by verse or version..."
    onkeyup="filterHistory()"
    style="
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1em;
      flex: 1;
      min-width: 200px;
    "
  />
  <select
    id="versionFilter"
    onchange="filterHistory()"
    style="
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1em;
      min-width: 200px;
    "
  >
    <option value="">All Versions</option>
    {% for item in history|map(attribute='version')|unique %}
    <option value="{{ item }}">{{ item }}</option>
    {% endfor %}
  </select>
</div>

{% if history %}
<div style="margin-bottom: 12px; display: flex; align-items: center; gap: 12px">
  <label
    ><input type="checkbox" id="selectAll" onclick="toggleSelectAll(this)" />
    Select All</label
  >
  <button onclick="deleteSelected()" class="button delete">
    üóëÔ∏è Delete Selected
  </button>
</div>

<form id="bulkDeleteForm" method="POST" action="/delete_bulk">
  <div id="historyList">
    {% for item in history %}
    <div
      class="history-entry"
      data-verse="{{ item.verse | lower }}"
      data-version="{{ item.version }}"
      style="
        background: white;
        border-radius: 8px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        padding: 16px;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
      "
    >
      <div style="flex: 1; display: flex; align-items: center">
        <input
          type="checkbox"
          name="selected_files"
          value="{{ item.filename }}"
          class="select-checkbox"
          style="margin-right: 12px"
        />
        <div
          style="
            background-color: #f1f5f9;
            padding: 8px 12px;
            border-radius: 6px;
            flex-grow: 1;
          "
        >
          <strong style="color: #1a202c">
            {{ item.verse }} ({{ item.version }}) {% if item.cursive %}
            <span class="cursive-badge">‚úçÔ∏è Cursive</span>
            {% endif %} </strong
          ><br />
          <span class="history-meta" style="color: #666; font-size: 0.95em">
            {{ item.timestamp.strftime('%B %d, %Y at %I:%M %p') if
            item.timestamp else 'Date unknown' }}
          </span>
        </div>
      </div>
      <div class="actions" style="flex-shrink: 0">
        <a
          href="{{ url_for('download_file', filename=item.filename) }}"
          class="button"
          >üì• Download</a
        >
        <a
          href="{{ url_for('delete_worksheet', filename=item.filename) }}"
          class="button delete"
          onclick="return confirm('Are you sure you want to delete this worksheet?')"
          >üóëÔ∏è Delete</a
        >
      </div>
    </div>
    {% endfor %}
  </div>
</form>

{% else %}
<div
  class="empty-state"
  style="text-align: center; padding: 60px 0; color: #999"
>
  <p>No worksheets yet. Generate one to see history here!</p>
  <a
    href="/generate"
    class="button"
    style="
      display: inline-block;
      background: #2b6cb0;
      color: white;
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: bold;
      text-decoration: none;
    "
  >
    Create a Worksheet
  </a>
</div>
{% endif %} {% endblock %} {% block extra_scripts %}
<script>
  function filterHistory() {
    const query = document.getElementById("searchInput").value.toLowerCase();
    const version = document
      .getElementById("versionFilter")
      .value.toLowerCase();
    const entries = document.querySelectorAll(".history-entry");

    entries.forEach((entry) => {
      const verse = entry.dataset.verse || "";
      const vers = entry.dataset.version || "";
      const match =
        (!query || verse.includes(query) || vers.includes(query)) &&
        (!version || vers === version);
      entry.style.display = match ? "flex" : "none";
    });
  }

  function toggleSelectAll(source) {
    const checkboxes = document.querySelectorAll(".select-checkbox");
    checkboxes.forEach((cb) => (cb.checked = source.checked));
  }

  function deleteSelected() {
    const form = document.getElementById("bulkDeleteForm");
    const selected = form.querySelectorAll(".select-checkbox:checked");
    if (selected.length === 0) {
      alert("No worksheets selected.");
      return;
    }
    if (
      confirm(
        `Are you sure you want to delete ${selected.length} worksheet(s)?`
      )
    ) {
      form.submit();
    }
  }

  if (localStorage.getItem("theme") === "dark") {
    document.body.classList.add("dark");
  }
</script>

<style>
  .actions {
    display: flex;
    gap: 8px;
  }

  .button.delete {
    background: #e53e3e;
  }

  .button.delete:hover {
    background: #c53030;
  }

  .cursive-badge {
    background-color: #f6ad55;
    color: white;
    font-size: 0.75em;
    font-weight: bold;
    padding: 2px 6px;
    border-radius: 6px;
    margin-left: 6px;
    vertical-align: middle;
  }

  body.dark .cursive-badge {
    background-color: #dd6b20;
  }

  body.dark .button.delete {
    background: #9b2c2c;
  }

  body.dark .button.delete:hover {
    background: #822727;
  }
</style>
{% endblock %}
